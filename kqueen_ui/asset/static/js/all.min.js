"use strict";d3.hive={},d3.hive.link=function(){function t(t,r){var i,o=e(n,this,t,r),c=e(a,this,t,r);c.a<o.a&&(i=c,c=o,o=i),c.a-o.a>Math.PI&&(o.a+=2*Math.PI);var s=o.a+(c.a-o.a)/3,d=c.a-(c.a-o.a)/3;return o.r0-o.r1||c.r0-c.r1?"M"+Math.cos(o.a)*o.r0+","+Math.sin(o.a)*o.r0+"L"+Math.cos(o.a)*o.r1+","+Math.sin(o.a)*o.r1+"C"+Math.cos(s)*o.r1+","+Math.sin(s)*o.r1+" "+Math.cos(d)*c.r1+","+Math.sin(d)*c.r1+" "+Math.cos(c.a)*c.r1+","+Math.sin(c.a)*c.r1+"L"+Math.cos(c.a)*c.r0+","+Math.sin(c.a)*c.r0+"C"+Math.cos(d)*c.r0+","+Math.sin(d)*c.r0+" "+Math.cos(s)*o.r0+","+Math.sin(s)*o.r0+" "+Math.cos(o.a)*o.r0+","+Math.sin(o.a)*o.r0:"M"+Math.cos(o.a)*o.r0+","+Math.sin(o.a)*o.r0+"C"+Math.cos(s)*o.r1+","+Math.sin(s)*o.r1+" "+Math.cos(d)*c.r1+","+Math.sin(d)*c.r1+" "+Math.cos(c.a)*c.r1+","+Math.sin(c.a)*c.r1}function e(t,e,n,a){var s=t.call(e,n,a),d=+("function"==typeof r?r.call(e,s,a):r)+c,l=+("function"==typeof i?i.call(e,s,a):i);return{r0:l,r1:i===o?l:+("function"==typeof o?o.call(e,s,a):o),a:d}}var n=function(t){return t.source},a=function(t){return t.target},r=function(t){return t.angle},i=function(t){return t.radius},o=i,c=0;return t.source=function(e){return arguments.length?(n=e,t):n},t.target=function(e){return arguments.length?(a=e,t):a},t.angle=function(e){return arguments.length?(r=e,t):r},t.radius=function(e){return arguments.length?(i=o=e,t):i},t.startRadius=function(e){return arguments.length?(i=e,t):i},t.endRadius=function(e){return arguments.length?(o=e,t):o},t};var K8SVisualisations=function(t){return t=t||{},t.forcedChart=t.forcedChart||{},t.forcedChart.init=function(e,n,a){if(t.forcedChart.cache={},a=a||{},!n)throw new Error("Cannot init K8S forced layout chart visualisation, invalid data given "+n);var r=(d3.select(e),{Pod:"#vertex-Pod",ReplicationController:"#vertex-ReplicationController",Node:"#vertex-Node",Service:"#vertex-Service",ReplicaSet:"#vertex-ReplicaSet",Container:"#vertex-Container",Deployment:"#vertex-Deployment",Namespace:"#vertex-Namespace"}),i=t.forcedChart.constructChart(e,{kinds:r});i.render(i.data(n.items,n.relations),a),i.select()},t.forcedChart.constructChart=function(e,n){function a(t){x=t,w.selectAll("g").classed("selected",function(e){return e.item===t})}function r(){p=null,d=s.node().clientWidth,l=s.node().clientHeight,k.size([d,l]),w.attr("viewBox","0 0 "+d+" "+l),i()}function i(){b=w.selectAll("line").data(g),b.exit().remove(),b.enter().insert("line",":first-child"),b.attr("class",function(t){return t.kinds}),b.on("mouseover",M.linkOver).on("mouseout",M.out),$=w.selectAll("g").data(m,function(t){return t.id}),$.on("mouseover",M.nodeOver).on("mouseout",M.out),$.exit().remove();var t=$.enter().append("g").call(C);return a(x),k.nodes(m).links(g).start(),t}function o(){var e=m,n=y;m=[],g=[],y={};var a,r,o,c;for(r in f)a=f[r],o=a.kind,u&&!u[o]||(c=e[n[r]],c||(c=t.forcedChart.cache[r],delete t.forcedChart.cache[r],c||(c={})),c.id=r,c.item=a,y[r]=m.length,m.push(c));var s,v,p,x,k;for(s=0,v=h.length;s<v;s++)p=h[s],x=y[p.source],k=y[p.target],void 0!==x&&void 0!==k&&g.push({source:x,target:k,kinds:m[x].item.kind+m[k].item.kind});return d&&l?i():d3.select()}function c(){window.clearTimeout(p),p=window.setTimeout(r,150)}var s=d3.select(e);s.html("");var d,l,u=n.kinds,f=[],h=[],v=20;n.radius&&(v=n.radius);var p,m=[],g=[],y={},x=null,k=n.force;k||(k=d3.layout.force().charge(-60).linkDistance(100));var C=k.drag(),w=s.append("svg").attr("viewBox","0 0 1600 1200").attr("preserveAspectRatio","xMidYMid meet").attr("class","kube-topology"),M={linkOver:function(t){w.selectAll("line").classed("active",function(e){return e===t}),w.selectAll(".node circle").classed("active",function(e){return e===t.source||e===t.target}),w.selectAll(".node text").classed("active",function(e){return e===t.source||e===t.target})},nodeOver:function(t){w.selectAll("line").classed("active",function(e){return e.source===t||e.target===t}),d3.select(this).select("circle").classed("active",!0),d3.select(this).select("text").classed("active",!0)},out:function(t){w.selectAll(".active").classed("active",!1)}},$=d3.select(),b=d3.select();return k.on("tick",function(){b.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),$.attr("cx",function(t){return t.x=t.fixed?t.x:Math.max(v,Math.min(d-v,t.x)),t.x}).attr("cy",function(t){return t.y=t.fixed?t.y:Math.max(v,Math.min(l-v,t.y)),t.y}).attr("transform",function(t){return"translate("+t.x+","+t.y+")"})}),C.on("dragstart",function(t){a(t.item),!0!==t.fixed&&(t.floatpoint=[t.x,t.y]),t.fixed=!0,d3.select(this).classed("fixed",!0)}).on("dragend",function(t){var e=!0;t.floatpoint&&(e=t.x<t.floatpoint[0]-5||t.x>t.floatpoint[0]+5||t.y<t.floatpoint[1]-5||t.y>t.floatpoint[1]+5,delete t.floatpoint),t.fixed=e&&t.x>3&&t.x<d-3&&t.y>=3&&t.y<l-3,d3.select(this).classed("fixed",t.fixed)}),w.on("dblclick",function(){w.selectAll("g").classed("fixed",!1).each(function(t){t.fixed=!1}),k.start()}),window.addEventListener("resize",c),r(),c(),{select:a,kinds:function(t){u=t;var e=o();return[$,e]},data:function(t,e){f=t||{},h=e||[];var n=o();return[$,n]},render:function(t,e){e=e||{};var n=t[0],a=t[1];a.attr("class",function(t){return t.item.kind}),a.append("use").attr("xlink:href",function(t){return u[t.item.kind]}),a.append("title"),e.hasOwnProperty("nodeClickFn")&&"function"==typeof e.nodeClickFn&&n.on("click",e.nodeClickFn),n.selectAll("title").text(function(t){return t.item.metadata.name}),n.classed("weak",function(t){var e=t.item.status;return!(!e||!e.phase||"Running"===e.phase)})},close:function(){window.removeEventListener("resize",c),window.clearTimeout(p);var e,n;t.forcedChart.cache={};for(e in y)n=m[y[e]],delete n.item,t.forcedChart.cache[e]=n;m=[],y={}}}},t}(K8SVisualisations||{}),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},K8SVisualisations=function(t){return t=t||{},t.hiveChart=t.hiveChart||{},t.hiveChart.init=function(t,e,n){function a(){var e,a,o=d3.select(t);"auto"===r&&(a=o.node().clientWidth),"auto"===i&&(e=o.node().clientHeight),o.html("");var c=o.append("svg").attr("width",a).attr("height",e).append("g").attr("transform","translate("+(a/2-80)+","+(e/2-20)+")"),d=c.selectAll(".node").data(s).enter().append("g");d.append("line").attr("class","axis").attr("transform",function(t){return"rotate("+t.angle+")"}).attr("x1",function(t){return f[t.kind].range()[0]}).attr("x2",function(t){return f[t.kind].range()[1]});var l=d3.select("#HiveChartTooltip");l.empty()&&(l=d3.select("body").append("div").attr("id","HiveChartTooltip").attr("class","tooltip").style("opacity",0)),d.append("text").attr("class","axis-label").attr("font-size","16px").attr("font-family","Open Sans").attr("text-anchor","middle").attr("alignment-baseline","central").text(function(t){return t.name}).attr("transform",function(t){return"translate("+(f[t.kind].range()[1]+30)*Math.cos(Math.radians(t.angle))+", "+(f[t.kind].range()[1]+30)*Math.sin(Math.radians(t.angle))+")"});var u={linkOver:function(t){c.selectAll(".link").classed("active",function(e){return e===t}),c.selectAll(".node circle").classed("active",function(e){return e===t.source||e===t.target}),c.selectAll(".node text").classed("active",function(e){return e===t.source||e===t.target})},nodeOver:function(t){c.selectAll(".link").classed("active",function(e){return e.source===t||e.target===t}),d3.select(this).select("circle").classed("active",!0),d3.select(this).select("text").classed("active",!0),l.html("Node - "+t.name+"<br/>Kind - "+t.kind).style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY-28+"px"),l.transition().duration(200).style("opacity",.9)},out:function(t){c.selectAll(".active").classed("active",!1),l.transition().duration(500).style("opacity",0)}};c.selectAll(".link").data(p).enter().append("path").attr("class","link").attr("d",d3.hive.link().angle(function(t){return Math.radians(m(t))}).radius(function(t){return t.kind?f[t.kind](t.y*v[t.kind]-.1):0})).on("mouseover",u.linkOver).on("mouseout",u.out);var y=c.selectAll(".node").data(h).enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+f[t.kind](t.y*v[t.kind]-.1)*Math.cos(Math.radians(m(t)))+", "+f[t.kind](t.y*v[t.kind]-.1)*Math.sin(Math.radians(m(t)))+")"}).on("mouseover",u.nodeOver).on("mouseout",u.out);n.hasOwnProperty("nodeClickFn")&&"function"==typeof n.nodeClickFn&&y.on("click",n.nodeClickFn),y.append("use").attr("xlink:href",function(t){return g(t.kind)})}if(n=n||{},!e)throw new Error("Cannot init K8S hive chart visualisation, invalid data given "+e);var r=n.width||"auto",i=n.height||"auto",o=n.outerRadius||400,c=n.innerRadius||60,s=[{x:0,angle:30,radius:420,name:"Pods",kind:"Pod"},{x:1,angle:270,radius:200,name:"Nodes",kind:"Node"},{x:2,angle:150,radius:240,name:"Services",kind:"Service"},{x:3,angle:210,radius:240,name:"Deployments",kind:"Deployment"},{x:4,angle:90,radius:240,name:"Namespaces",kind:"Namespace"}],d={Pod:"#vertex-Pod",ReplicationController:"#vertex-ReplicationController",Node:"#vertex-Node",Service:"#vertex-Service",ReplicaSet:"#vertex-ReplicaSet",Container:"#vertex-Container",Deployment:"#vertex-Deployment",Namespace:"#vertex-Namespace"},l={Pod:0,Node:0,Service:0,Deployment:0,Namespace:0,Container:0},u={Pod:0,Node:1,Service:2,Deployment:3,Namespace:4,Container:5},f={Pod:d3.scale.linear().range([c,420]),Node:d3.scale.linear().range([c,200]),Service:d3.scale.linear().range([c,240]),Deployment:d3.scale.linear().range([c,240]),Namespace:d3.scale.linear().range([c,240])};"object"===_typeof(e.items)&&(e.items=Object.values(e.items));var h=function(t){return t.map(function(t){return t.id=t.metadata.uid,t.name=t.metadata.name||"Unnamed node",["Pod","Service","Node","Deployment","Namespace"].indexOf(t.kind)<0&&(t.kind="Other"),t.x=u[t.kind],l[t.kind]++,t.y=l[t.kind],t})}(e.items),v={Service:1/l.Service,Pod:1/l.Pod,Node:1/l.Node,Deployment:1/l.Deployment,Namespace:1/l.Namespace},p=function(t,e){return e.map(function(e){var n={};return t.forEach(function(t){e.source==t.id?n.source=t:e.target==t.id&&(n.target=t)}),n.hasOwnProperty("source")&&n.hasOwnProperty("target")||(n=e),n})}(h,e.relations),m=function(t){var e=0;return s.forEach(function(n){t.kind==n.kind&&(e=n.angle)}),e},g=(d3.scale.linear().range([c,o]),function(t){return d[t]});a(),window.removeEventListener("resize",a),window.addEventListener("resize",a)},t}(K8SVisualisations||{}),K8SVisualisations=function(t){return t=t||{},t.init=function(e){$(document).one("shown.bs.tab","a[href='#addons']",function(t){var e=$(".grid").isotope({itemSelector:".addon-item",layoutMode:"fitRows"});$(".grid").each(function(){var t=$(this);t.css("min-height",t.innerHeight())}),$("#filters").on("click","a",function(t){t.preventDefault();var n=$(this).attr("data-filter");e.isotope({filter:n})})}),$(function(){$("#ForcedLayoutGraphBtn").on("click",function(t){$("#HiveGraphContainer").css("z-index","1").css("pointer-events","none"),$("#ForcedLayoutGraphContainer").css("z-index","2").css("pointer-events","all"),$("#HiveGraphBtn").removeClass("active"),$("#ForcedLayoutGraphBtn").addClass("active")}),$("#HiveGraphBtn").on("click",function(t){$("#ForcedLayoutGraphContainer").css("z-index","1").css("pointer-events","none"),$("#HiveGraphContainer").css("z-index","2").css("pointer-events","all"),$("#ForcedLayoutGraphBtn").removeClass("active"),$("#HiveGraphBtn").addClass("active")}),$(".topology-legend svg").each(function(){var t=function(t,e){var n=Object.entries(e).filter(function(t){return t[1]}).map(function(t){return t[0]}),a={};return Object.entries(window._originalGraphData.items).forEach(function(t){-1!=n.indexOf(t[1].kind)&&(a[t[0]]=t[1])}),{items:a,kinds:window._originalGraphData.kinds,relations:window._originalGraphData.relations}};$(this).on("click",function(e){$(e.target).parent().toggleClass("filterDisabled");var a={};$(".topology-legend svg").each(function(){var t=$(this);a[t.attr("data-kind")]=!t.hasClass("filterDisabled")}),n(t(window._originalGraphData,a))})})});var n=function(e){var n=function(t){console.log(t),"item"in t?$("#resource-detail").html("<dl><dt>Name</dt><dd>"+t.item.metadata.name+"</dd><dt>Kind</dt><dd>"+t.item.kind+"</dd><dt>Namespace</dt><dd>"+t.item.metadata.namespace+"</dd></dl>"):$("#resource-detail").html("<dl><dt>Name</dt><dd>"+t.metadata.name+"</dd><dt>Kind</dt><dd>"+t.kind+"</dd><dt>Namespace</dt><dd>"+t.metadata.namespace+"</dd></dl>")};e&&(window._graphData=e),t.forcedChart.init("#topology-graph",$.extend({},window._graphData),{nodeClickFn:n}),t.hiveChart.init("#HiveChart",$.extend({},window._graphData),{nodeClickFn:n}),$("#HiveGraphBtn, #ForcedLayoutGraphBtn").attr("disabled",!1)};$(document).one("shown.bs.tab","a[href='#topology']",function(t){d3.json(e,function(t){window._originalGraphData=t,n(t)})})},t}(K8SVisualisations||{});Math.radians=function(t){return t*Math.PI/180},Math.degrees=function(t){return 180*t/Math.PI},$(document).ready(function(){location.hash&&$("a[data-tabcode='"+location.hash+"']").tab("show"),$(document.body).on("click","a[data-toggle]",function(t){location.hash=this.getAttribute("data-tabcode")})}),$(window).on("popstate",function(){var t=location.hash;location.hash&&$("a[data-tabcode='"+t+"']").tab("show")});